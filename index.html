<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>


  $(window).resize(function() {
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    c.height = window.innerHeight;
    c.width = window.innerWidth;
  });
  $(document).ready(function() {
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    c.height = window.innerHeight;
    c.width = window.innerWidth;
  });
  var sessionid;
  var socket = io.connect('http://localhost:3000');
  socket.on('sessid', function(id){
    sessionid = id;

  });
  socket.on('players', function (data) {
    console.log(data);
    socket.emit('move', { move: 'data' });
  });
  var players = [];
  socket.on('updatePlayers', function(data){
    players = data.data;
      renderPlayers();
      console.log(data.player)
      animatePlayer(data.player);
    });
  function renderPlayers(){
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    ctx.fillStyle = "#000";
    var length = players.length;
    c.width = c.width;
    var currClient;
    for(var i = 0; i < length; i++){
      if(sessionid == players[i].id){
      //currClient = i;
    } else {
      ctx.fillRect(players[i].x, players[i].y, 35, 35);
    }
    }
      //ctx.fillStyle = "#ff0000";
    //ctx.fillRect(players[currClient].x, players[currClient].y, 35, 35);
    }
  function animatePlayer(player){
    var c = document.getElementById("canvas");
    var ctx = c.getContext("2d");
    var velY = 0,
    velX = 0,
    speed = 2,
    friction = 0.98,
    y = player.y,
    x = player.x;
    if(player.moveDir == "left"){
      if(velX > -speed){
        velX--;
      }
    } else if (player.moveDir == "right"){
      if(velX < speed){
        velX++;
      }
    } else if (player.moveDir == "up"){
      
    } else if (player.moveDir == "down"){
      
    }
    velY *= friction;
    y += velY;
    velX *= friction;
    x += velX;
    c.width = c.width;
    renderPlayers();
    ctx.fillStyle = "#ff0000";
    ctx.fillRect(x, y, 35, 35);
    setTimeout(animatePlayer(player), 15);
  }
  
  $(document).keydown(function(e) {
    var whichKey;
    switch(e.which){
          case 37:
          whichKey = "left";
          break;

          case 38:
          whichKey = "up";
          break;

          case 39:
          whichKey = "right";
          break;

          case 40:
          whichKey = "down";
          break;

          default: return;
  }
  console.log(whichKey);
      socket.emit('move', { move: whichKey });
      
  e.preventDefault();
      });


  function getCookie(name){
      var pattern = RegExp(name + "=.[^;]*")
      matched = document.cookie.match(pattern)
      if(matched){
          var cookie = matched[0].split('=')
          return cookie[1]
      }
      return false
  }


</script>
<style type="text/css">

  body {
    background-color: #dfdfdf;
  }
</style>
  </head>
  <body>
    <canvas id="canvas">
      
    </canvas>
  </body>
</html>
