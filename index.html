<html>
  <head>
    <!--<script src="/socket.io/socket.io.js"></script>-->
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
  var gameLoopID;
  var latestPlayers = [];
  var players = [];
  var player = new player(1, 35, 35, 0, 0);
  var loopNum;
  var positionX = 100.0;
  var positionY = 175.0;
  var velocityX = 0.0;
  var velocityY = 0.0;
  var gravity = 0.5;
  var onGround = false;
  var incInterval;
  var LeftKeyDown = false;
  var RightKeyDown = false;



  var sessionid;
  var socket = io.connect('http://localhost:3000');
  socket.on('sessid', function(id){
    sessionid = id;

  });
  socket.on('players', function (data) {
    console.log(data);
  });
  socket.on('updatePlayers', function(data){
      latestPlayers = data.data;
      console.log(data.player)
    });

  function player(id, x, y){
    this.id = id;
    this.x = x;
    this.y = y;
    this.velocityX = velX;
    this.velocityY = velY;
  }
  $(window).resize(function() {
    c.height = window.innerHeight -50;
    c.width = window.innerWidth - 50;
  });
  $(document).ready(function() {
    c = document.getElementById('canvas');
    ctx = canvas.getContext('2d');
    c.height = window.innerHeight -50;
    c.width = window.innerWidth -50;
    player.x = 35;
    player.y = 35;
    gameLoop();
  });
  $(document).keydown(function(e) {
    var whichKey;

    switch(e.which){
          case 37:

          player.moveDir = "left";
          //player.x += -5;
          velocityX = -3;
          loopNum = 0;
          LeftKeyDown = true;
          //clearInterval(incInterval);
          //increaseVelocity();
          break;
          case 16:
            if(LeftKeyDown){
              velocityX = -6;
            } else if (RightKeyDown){
              velocityX = 6;
            }
          //velocityX = 3;
          break;

          case 32:
          //player.y += -5;
          StartJump();
          break;

          case 39:
          player.moveDir = "right";
          //player.x += 5;

          RightKeyDown = true;
          velocityX = 3;
          break;
          default: return;
          socket.emit('move', {player : player});
  }
  e.preventDefault();
      });
      $(document).keyup(function(e){
        switch(e.which){
        case 32:
          EndJump();
        break;
      case 37:
        velocityX = 0;
        loopNum = -1;
        LeftKeyDown = false;
        //clearInterval(incInterval);
        velocityX = 0;
        break;
    case 39:
      velocityX = 0;
      RightKeyDown = false;
      break;
      case 16:
        if(LeftKeyDown){
          velocityX = -3;
        } else if (RightKeyDown){
          velocityX = 3;
        }
      //break;
    default: return;
      }
      });
      //vy = 0;
      //function animateJump(){
      //  jump = true;
      //  player.y += vy;
      //  vy *= .98;
      //  console.log('test');
      //  renderPlayer(player.x, player.y);
      //  requestAnimationFrame(animateJump);
      //}
    function StartJump(){
      if(onGround){
        velocityY = -12.0;
        onGround = false;
      }
    }
    function EndJump(){
      if(velocityY < -6.0){
        velocityY = -6.0;
      }
    }





    function Update(){
          velocityY += gravity;
          player.y += velocityY;
          player.x += velocityX;

        if(player.y > 175.0)
        {
          player.y = 175.0;
          velocityY = 0.0;
          onGround = true;
        }

        //if(player.x < 10 || player.x > 190)
        //  velocityX *= -1;

        }
      function renderPlayer(x, y){
        c.width = c.width;
        ctx.fillStyle = "#ff0000";
        ctx.fillRect(x, y, 35, 35);
      }
    function Render(){
      ctx.fillStyle = "#ff0000";
      ctx.fillRect(player.x, player.y, 35, 35);
    }
    function clearMap(){
      c.width = c.width;
    }
  //function animatePlayers(){
  //  var playerLength = players.length;
  //  for(int i = 0; i < playerLength; i++){
  //    animatePlayer(players[i]);
  //  }
  //}
  function gameLoop(){
    clearMap();
    Render();
    gameLoopID = requestAnimationFrame(gameLoop);
  }
</script>
<style type="text/css">

  body {
    background-color: #dfdfdf;
    margin-top: 0;
    margin-left: 0;
    margin-right: 0;
    margin-bottom: 0;
  }
</style>
  </head>
  <body>
    <canvas id="canvas">

    </canvas>
  </body>
</html>
